# Default values for openvpn.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: blinklabs/openvpn
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  # For security, consider using digest pinning: tag: "0.4.0@sha256:..."
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext:
  capabilities:
    add:
      - NET_ADMIN
  allowPrivilegeEscalation: false
  # readOnlyRootFilesystem: true  # May not be feasible for VPN operations
  # runAsNonRoot: true  # Not possible with NET_ADMIN capability
  runAsUser: 0  # Explicitly run as root for initial setup, container drops to nobody

service:
  type: ClusterIP
  port: 1194
  # nodePort:
  protocol: TCP
  annotations: {}
  # loadBalancerClass:

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # Recommended for OpenVPN: requests cpu: 100m, memory: 128Mi; limits cpu: 500m, memory: 512Mi
  # limits:
  #   cpu: 500m
  #   memory: 512Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

nodeSelector: {}
  # Example for secure nodes: kubernetes.io/os: linux

tolerations: []
  # Example for tolerating secure node taints:
  # - key: "secure"
  #   operator: "Equal"
  #   value: "vpn"
  #   effect: "NoSchedule"

affinity: {}
  # podAntiAffinity:
  #   preferredDuringSchedulingIgnoredDuringExecution:
  #   - weight: 100
  #     podAffinityTerm:
  #       labelSelector:
  #         matchLabels:
  #           {{- include "openvpn.selectorLabels" . | nindent 12 }}
  #       topologyKey: kubernetes.io/hostname

podDisruptionBudget:
  enabled: false
  minAvailable: 1

readinessProbe:
  exec:
    command:
    - /bin/sh
    - -c
    - grep -q openvpn /proc/1/cmdline
  initialDelaySeconds: 5
  periodSeconds: 10

networkPolicy:
  enabled: false
  # Allow ingress from specific sources (leave empty for all)
  allowedIngressSources: []
  # Additional egress rules (e.g., for DNS, NTP)
  additionalEgressRules: []

configFiles: []
  # - name: openvpn.conf
  #   content: |
  #     port 1194
  #     proto tcp
  #     dev tun
  #     server 10.8.0.0 255.255.255.0
  #     dh none
  #     ecdh-curve secp384r1
  #     ca ca.crt
  #     cert server.crt
  #     key server.key
  #     topology subnet
  #     tls-version-min 1.3
  #     cipher AES-256-GCM
  #     auth SHA256
  #     comp-lzo no
  #     compress
  #     block-outside-dns
  #     verb 0
  #     mlock
  #
  # - name: ca.crt
  #   secret: true
  #   content: |
  #     ca.crt content
  #
  # - name: server.crt
  #   secret: true
  #   content: |
  #     server.crt content
  #
  # - name: server.key
  #   secret: true
  #   content: |
  #     server.key content
  #
  # - name: dh2048.pem
  #   content: |
  #     dh2048.pem content
  #
  # - name: crl.pem
  #   configMapName: foo
  #   configMapKey: bar

nat:
  enabled: true
  # Source subnet for iptables MASQUERADE rule
  # This should match the subnet used for the VPN server
  source: 10.8.0.0/24
  # Output device
  device: eth0

# Additional startup script content
startupScript: ''

metrics:
  enabled: false
  image:
    repository: ghcr.io/natrontech/openvpn-exporter
    pullPolicy: IfNotPresent
    tag: v1.0.2
  port: 9176
  statusFile: /var/tmp/openvpn/openvpn-status.log
  resources: {}
  securityContext: {}
    # readOnlyRootFilesystem: true
    # runAsNonRoot: true
    # runAsUser: 1000
  service:
    enabled: false
    type: ClusterIP
    port: 9176
    # nodePort:
    protocol: TCP
    annotations: {}
    # loadBalancerClass:

bind:
  enabled: false
  image:
    repository: cytopia/bind
    pullPolicy: IfNotPresent
    tag: 0.29
  env:
    dns_forwarder: 8.8.8.8
    extra_hosts: ~
  resources: {}
